{"filter":false,"title":"url.js","tooltip":"/models/url.js","undoManager":{"mark":0,"position":0,"stack":[[{"start":{"row":0,"column":0},"end":{"row":36,"column":21},"action":"remove","lines":["var mongoose = require('mongoose');","var Schema = mongoose.Schema;","","// create the counters schema with an _id field and a seq field","var CounterSchema = Schema({","    _id: {type: String, required: true},","    seq: { type: Number, default: 0 }","});","","// create a model from that schema","var counter = mongoose.model('counter', CounterSchema);","","// create a schema for our links","var urlSchema = new Schema({","  _id: {type: Number, index: true},","  long_url: String,","  created_at: Date","});","","// The pre('save', callback) middleware executes the callback function","// every time before an entry is saved to the urls collection.","urlSchema.pre('save', function(next){","  var doc = this;","  // find the url_count and increment it by 1","  counter.findByIdAndUpdate({_id: 'url_count'}, {$inc: {seq: 1} }, function(error, counter) {","      if (error)","          return next(error);","      // set the _id of the urls collection to the incremented value of the counter","      doc._id = counter.seq;","      doc.created_at = new Date();","      next();","  });","});","","var Url = mongoose.model('Url', urlSchema);","","module.exports = Url;"],"id":4},{"start":{"row":0,"column":0},"end":{"row":30,"column":21},"action":"insert","lines":["var mongoose = require('mongoose');","var Schema = mongoose.Schema;","","var CounterSchema = Schema({","    _id: {type: String, required: true},","    seq: { type: Number, default: 0 }","});","","var counter = mongoose.model('counter', CounterSchema);","","// create a schema for our links","var urlSchema = new Schema({","  _id: {type: Number, index: true},","  long_url: String,","  created_at: Date","});","","urlSchema.pre('save', function(next){","  var doc = this;","  counter.findByIdAndUpdate({_id: 'url_count'}, {$inc: {seq: 1} }, function(error, counter) {","      if (error)","          return next(error);","      doc.created_at = new Date();","      doc._id = counter.seq;","      next();","  });","});","","var Url = mongoose.model('Url', urlSchema);","","module.exports = Url;"]}]]},"ace":{"folds":[],"scrolltop":307,"scrollleft":0,"selection":{"start":{"row":30,"column":21},"end":{"row":30,"column":21},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":16,"state":"start","mode":"ace/mode/javascript"}},"timestamp":1465433771000,"hash":"6ef62b0b90c0a58063592e5c448db577c1e9d178"}